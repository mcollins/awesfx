#
# Sample Makefile for awelib shared library
#

INSTDIR = /usr/local
LIBDIR = $(INSTDIR)/lib

LIBVER = 0.4.4
LIBNAME = awe

LIBSO = lib$(LIBNAME).so
LIB = $(LIBSO).$(LIBVER)

CDEBUGFLAGS = -O2
CINCS = -I../include
CDEFS = -Wall -Dlinux

CFLAGS = $(CDEBUGFLAGS) $(CINCS) $(CDEFS)

INSTLIBFLAGS = -c -m 0755

PICFLAGS = -fPIC

OBJS = awe_parm.o bool.o cmpopen.o dynload.o fskip.o gentxt.o loadbank.o\
	loadtext.o malloc.o mygetopt.o optfile.o parsesf.o path.o sample.o\
	sbkconv.o sffile.o sfitem.o sfopts.o sfout.o slist.o dummy.o

RM = rm -f
LN = ln -sf
INSTALL = install

################

all: $(LIB) $(LIBSO)

$(LIBSO): $(LIB)
	$(LN) $(LIB) $@

$(LIB): $(OBJS)
	$(RM) $(LIB) $(LIBSO)
	$(CC) -o $@ -shared -Wl,-soname,$(LIBSO) $(OBJS) -lc

install: $(LIB) $(LIBSO)
	@if [ -d $(LIBDIR) ]; then set +x; \
	else (set -x; mkdir -p $(LIBDIR)); fi
	$(RM) $(LIBDIR)/$(LIB)
	$(INSTALL) $(INSTLIBFLAGS) $(LIB) $(LIBDIR)
	$(RM) $(LIBDIR)/$(LIBSO)
	$(LN) $(LIB) $(LIBDIR)/$(LIBSO)

install.man:

clean:
	$(RM) $(LIB) $(LIBSO)
	$(RM) $(OBJS)

%.o: %.c
	$(CC) -c $(CFLAGS) $(PICFLAGS) $*.c

